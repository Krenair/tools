#!/usr/bin/env python
# coding=utf8
from __future__ import print_function

import argparse
import os
import sr.tools.spending as spending
from sr.tools.budget import BudgetTree
from subprocess import check_call
import sys

p = argparse.ArgumentParser()
p.add_argument("budgetline", help="The budget line to inspect")
args = p.parse_args()

root = spending.find_root()
budget = spending.load_budget_with_spending(root)
line = budget.path(args.budgetline)

if isinstance(line, BudgetTree):
    "Summary for tree", args.budgetline
    budgeted = sum([x.cost for x in line.walk()])
    spent = sum([x.spent for x in line.walk()])

else:
    "Summary for line", args.budgetline
    budgeted = line.cost
    spent = line.spent

"Budgeted:\t", budgeted
"Spent:\t\t", spent

if spent > budgeted:
    "OVER BUDGET"

print
"Transactions:"

sys.stdout.flush()

line = args.budgetline.replace("/", ":")
if line[0] == ":":
    line = account[1:]

check_call(["ledger",
            "--file", os.path.join( root, "spending.dat" ),
            "reg", "Expenses:{0}".format(line) ])
