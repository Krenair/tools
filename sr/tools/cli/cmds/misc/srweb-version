#!/usr/bin/env python
from __future__ import print_function

import json
try:
    from urllib2 import urlopen
except ImportError:
    from urllib.request import urlopen
import sys


base_url = 'https://www.studentrobotics.org/.git/'


def fetch(url):
    page = urlopen(url)
    data = page.read()

    if data is None:
        print('Failed to download from: {url}.'.format(url=url),
              file=sys.stderr)
        exit(1)

    return data.strip().decode('utf-8')


def main():
    quiet = False
    if any(True for arg in sys.argv if arg in ['-q', '--quiet']):
        quiet = True

    url = base_url + "HEAD"
    data = fetch(url)

    ref_base = 'ref: '

    # it's a hash
    if data[:len(ref_base)] != ref_base:
        print(data[:9])
        exit(0)

    ref = data[len(ref_base):]
    if not quiet:
        print('On:', ref)

    url = base_url + ref
    data = fetch(url)
    print(data)


if __name__ == '__main__':
    main()
