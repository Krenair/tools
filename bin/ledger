#!/usr/bin/env python
import os
from sr import spending, Config
from sr.spending import NotSpendingRepo
from subprocess import check_call
import sys

# Invoke ledger on the SR spending repo
# Check that we are indeed invoking it on spending.git

config = Config()

# Default to using the spending.git specified in the config
root = config["spending"]
if root is not None:
    root = os.path.expanduser(root)
else:
    "Not specified in the config"
    root = os.getcwd()

try:
    "Check that it's actually spending.git"
    root = spending.find_root( path = root )
except NotSpendingRepo:
    print >>sys.stderr, "This isn't SR spending.git"
    print >>sys.stderr, "Solve this by either:"
    print >>sys.stderr, " - Changing working directory to spending.git"
    print >>sys.stderr, " - Set the 'spending' config option in ~/.sr/config.yaml"
    exit(1)

args = sys.argv

if "--file" not in sys.argv:
    "Tell ledger where to look"
    args = [args[0]] + \
           [ "--file",
             os.path.join( root, "spending.dat" ) ] + \
           args[1:]

os.execvp( "ledger", args )

